version: 2.1
executors:
  build:
    machine:
      image: ubuntu-2004:202111-02
    resource_class: large

jobs:
  build:
    executor: build
    steps:
      - run:
          name: Set Git Configs & Secrets
          command: |
            git config --global user.email maharanasubhendu3@gmail.com
            git config --global user.name Subhendu-droid
            git config --global color.ui true
            git config --global credential.helper store
            echo "https://Subhendu-droid:$GIT_TOKEN@github.com" > ~/.git-credentials
     
      - run:
          name: Clone private repo
            git clone https://Subhendu-droid :$GIT_TOKEN@github.com/Subhendu-droid/env-file-for-UB PR
    
      - run:
          name: Clone botgram shell-bot repo and Generate config
          command: |
            git clone https://github.com/Subhendu-droid/shell-bot --depth 1 shell-bot
     
      - run:
          name: Run the bot
          command: |
            sudo bash ultroid.sh
     
      - run:
          name: Circle loop
          command: |
            git clone https://github.com/shell-bot-cirrus -b main loop
            cd loop || exit 1
            echo $(TZ='Asia/Kolkata' date) >> loop.txt
            git add loop.txt
            git commit -m "Workflow : Loop $(TZ='Asia/Kolkata' date)"
            git push -q https://$GIT_TOKEN@github.com/shell-boy-cirrus HEAD:main
